			{source}
			<?php
			function walk($val)
			{
				$nums = explode(':', $val);
				return [$nums[0] => $nums[1]];
			}
			if($_POST["action"] == "get_students")
			{ 
			 $db = JFactory::getDBO();
			 $sql="SELECT id, name FROM `txmb7_users` WHERE students_group=".$_POST["group_id"] ." ORDER BY `name`";
			 $db->setQuery($sql);
			 $students = $db->loadObjectList();

			 foreach ($students as $student)
			 {
				 print "<input data_id=".$student -> id." class='added_students username_input' name='textfield' type='text' value=".$student -> name.">"; 
			 } 
			die;
			}
			else
				if($_POST["action"] == "get_weeks")
				{
					$db = JFactory::getDBO();
					$sql="SELECT id FROM gr" . $_POST["group_id"] . "_week";
					$db->setQuery($sql);
					$weeks = $db->loadObjectList();
					foreach ($weeks as $week)
					{
						$i++;
						echo "<option class='added_weeks' value=".$week->id . ">".$i. "</option>";
					 }
				die;
				}
			else
				if($_POST["action"] == "get_class")
				{
					$db = JFactory::getDBO();
					$sql="SELECT * FROM gr" . $_POST["group_id"] . "_week WHERE id=" . $_POST["week_id"];
					$db->setQuery($sql);
					$classes = $db->loadObjectList();
					foreach ($classes as $class)
					{ 
							echo "<option class='added_classes' value=".$class->class1 . " >1 class</option>"; 
							echo "<option class='added_classes' value=".$class->class2 . ">2 class</option>";     		 
					}
					die;
				}
				else
				 if($_POST["action"] == "get_marks")
					{
						$db = JFactory::getDBO();
						$sql="SELECT id, name FROM `txmb7_users` WHERE students_group=".$_POST["group_id"] ." ORDER BY `name`";
						$db->setQuery($sql);
						$students = $db->loadObjectList();
						$students_array = [];
						foreach ($students as $student)
						{
							array_push($students_array, $student -> id);
						} 
						if($_POST["which_mark_id"] == "participation")
						{
							$which_mark = "participation";
						}else
						if($_POST["which_mark_id"] == "quiz")
						{
							$which_mark = "quiz";
						}else
						if($_POST["which_mark_id"] == "homework")
						{
							$which_mark = "homework";								
						}
						
						$sql="SELECT participation, quiz, homework FROM gr" . $_POST["group_id"] . "_class WHERE id=" . $_POST["class_id"];
						$db->setQuery($sql);
						$marks = $db->loadObjectList();	
						$new_array = array();
						
						foreach ($marks as $mark)
						{ 
							$decode  = $mark -> $which_mark;
							$array = explode(',', $decode);
							for($i = 0; $i < count($array); $i++)
							{
								$nums = explode(':', $array[$i]);
								$new_array[$nums[0]] = $nums[1];
							}
						}  	 	 	
						$curr_array = [];
						for($i = 0; $i < count($new_array); $i++)
						{ 
							$student_id = $students_array[$i]; 
							$mark = $new_array[$student_id]; 
							print "<input data_id=".$student_id." class='added_marks participation_input' name='textfield' type='text' value=$mark>"; 
						}					
						die;
					}
			?>
			<div class="control_panel">
			 <div class="select_group_block">
				<p id="stext">
					Группа
				</p>
					<select id="select_group">
					<option disabled selected>Выберете группу</option>
			<?php
				$db = JFactory::getDBO();
				$sql="SELECT * FROM `groups`";
				$db->setQuery($sql);
				$groups = $db->loadObjectList();
				foreach ($groups as $group)
				{
					print "<option value=".$group->id.">".$group -> name."</option>";
				}
			?>
					</select> 
				</div>
				<div class="select_week_block">
					<p id="stext">Неделя</p>
					<select id="select_week">
						<option disabled selected>Выберете неделю</option> 
					</select> 
				</div>
				 <div class="select_class_block">
					<p id="stext">Урок</p>
					<select id="select_class">
						<option disabled selected>Выберете урок</option> 
					</select> 
				</div>
				<div class="clear"></div>
			</div>
			<div class="input_fields">
			  <div class="input_students">
				<p class="hiden_elem column_name">
				  Имя
				</p>
			  </div>
			  <div class="input_participation">
				<p class="column_name hiden_elem">
				  Participation
				</p>
			  </div>
			  <div class="input_quiz">
				<p class="hiden_elem column_name">
				  Quiz
				</p>
			  </div>
			  <div class="input_homework">
				<p class=" column_name  hiden_elem">
				  Homework
				</p>
			  </div>
			</div>
			<script type="text/javascript">
				 jQuery.noConflict();
			 </script>
			<script type="text/javascript">    
				function SetUsersToPage(data)
				{
					jQuery(".input_students").append(data);
				} 

				function SetWeeksToPage(data)
				{
					jQuery("#select_week").append(data);
				} 

				function SetClassesToPage(data)
				{
					jQuery("#select_class").append(data);
				} 

				function SetStudentsMarkParticipation(data)
				{
					jQuery(".input_participation").append(data);
				} 
				function SetStudentsMarkParticipation(data)
				{
					jQuery(".input_participation").append(data);
				} 
				function SetStudentsMarkQuiz(data)
				{
					jQuery(".input_quiz").append(data);
				} 
				function SetStudentsMarkHomework(data)
				{
					jQuery(".input_homework").append(data);
				} 
				var group_id = 0;
				var week_id = 0;
				var class_id = 0;
				jQuery("#select_group").change(function()
				{
					jQuery(".hiden_elem").show();
					jQuery(".added_students").remove();
					jQuery(".added_classes").remove();
					jQuery(".added_weeks").remove();
					group_id = jQuery(this).attr('value');
					console.log(group_id);
					 jQuery.ajax({
						type: "post",
						url: 'http://localhost/school/index.php/lichnyj-kabinet/redaktirovanie-otsenok',
						data: "action=get_students&group_id="+group_id,
						success: function(data)
						{
							SetUsersToPage(data);
						}
					});
					 jQuery.ajax({
						type: "post",
						url: 'http://localhost/school/index.php/lichnyj-kabinet/redaktirovanie-otsenok',
						data: "action=get_weeks&group_id="+group_id,
						success: function(data) 
						{
							SetWeeksToPage(data);
						}
					}); 
				});
				jQuery("#select_week").change(function()
				{
					jQuery(".added_classes").remove();
					week_id = jQuery(this).attr('value');
					jQuery.ajax({
						type: "post",
						url: 'http://localhost/school/index.php/lichnyj-kabinet/redaktirovanie-otsenok',
						data: "action=get_class&group_id="+group_id+"&week_id="+week_id,
						success: function(data) 
						{
							SetClassesToPage(data);
						}
					}); 
				});
				 jQuery("#select_class").change(function()
				{ 
					class_id = jQuery(this).attr('value');
					jQuery.ajax({
						type: "post",
						url: 'http://localhost/school/index.php/lichnyj-kabinet/redaktirovanie-otsenok',
						data: "action=get_marks&group_id="+group_id+"&week_id="+week_id+"&class_id="+class_id+"&which_mark_id=participation",
						success: function(data) 
						{
							SetStudentsMarkParticipation(data);
						}
					}); 
					jQuery.ajax({
						type: "post",
						url: 'http://localhost/school/index.php/lichnyj-kabinet/redaktirovanie-otsenok',
						data: "action=get_marks&group_id="+group_id+"&week_id="+week_id+"&class_id="+class_id+"&which_mark_id=quiz",
						success: function(data) 
						{
							SetStudentsMarkQuiz(data);
						}
					}); 
					jQuery.ajax({
						type: "post",
						url: 'http://localhost/school/index.php/lichnyj-kabinet/redaktirovanie-otsenok',
						data: "action=get_marks&group_id="+group_id+"&week_id="+week_id+"&class_id="+class_id+"&which_mark_id=homework",
						success: function(data) 
						{
							SetStudentsMarkHomework(data);
						}
					}); 
				});
			</script>
			<div class="clear"></div>
			{/source}